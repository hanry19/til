# DB 모델링

## KEY : 자연키와 인조키

### 1. 자연키 (Natural Key)

회원 테이블 생성 시 회원이 늘어날 때 마다 값(로우)가 추가된다. 그럼 각각의 값을 구분할 수 있는 기본키(primary key)를 지정해야 한다. 

기본키는 값들을 확실히 구분하고, 변하지 않는 데이터가 되어야 한다. ⇒ 회원ID

여기까지 회원 테이블 생성 ⇒ 속성 추출 ⇒ 적절한 기본키 추출 !!

이렇듯 기본키를 위한 데이터가 아닌 비즈니스 모델에서 자연스레 나오는 속성으로 기본키를 정하는 것을 자연키(Natural Key)라고 한다. 

![Untitled](https://user-images.githubusercontent.com/63430211/117440715-62474280-af6f-11eb-8e70-9e1e3fa3e70f.png)


### 2. 인조키 (Artificial Key)

  ![Untitled 1](https://user-images.githubusercontent.com/63430211/117440730-68d5ba00-af6f-11eb-802e-63b335efbc2e.png)

이벤트 참여 개인정보를 제공받는 테이블이 있다. 

이벤트 참여를 받을 때는 참여자로부터 고유한 값을 입력받지 않는다. 때문에 앞선 회원 테이블의 ID 와 같은 고유값이 없다.

 기본키 설정은 어떻게 할까? 

일상을 빗대어 보면 카페에서 커피를 시키면 종업원으로 부터 식별가능한 번호표를 받는다.  

즉 참여자 번호를 부여하여 참여자가 몇명이든 그들을 구분할 수 있다는 것이다. 

(oracle의 Sqeuqnce, MySql의 Auto INcrement)

## 식별 & 비식별 관계

관계형 데이터베이스 테이블들의 관계 설정 시 일반적으로 외래키(FK)를 사용한다.  외래 키를 통해 다른 테이블과 같은 키를 공유 및 이용하여 JOIN 하여 관계를 이용한다.

이러한 외래키를 사용하여 관계 정립 시 식별과 비식별 관계  두가지 방법이 있다. 

### 0. 외래키(Foreign Key)

상품 테이블과 주문 테이블이 있다. 

두테이블의 관계는 어떻게 될까?

***하나의 상품***은 ***여러 주문***에서 구매할 수 있고, ***하나의 주문***은 ***여러 상품***을 구매할 수 있다. ⇒ **N:M 관계**

**다대다 관계의 경우** 중간에 **관계 테이블을 추가**해서 사용한다.

![Untitled 2](https://user-images.githubusercontent.com/63430211/117440749-6ffcc800-af6f-11eb-9ad0-df96ec7a8acf.png)

"주문_상품" 이라는 관계 테이블을 추가하였고ㅡ, 이젠 상품 테이블과 주문 테이블과 "1대다 , 다대 1" 의 관계를 가진다. 

( **주문_상품**이 없는 **상품**은 존재  / **주문_상품**이 없는 **주문**은 없다.)

관계 테이블 **주문_상품** 테이블은 **주문번호**와 **상품번호**를 갖는다.

**상품번호**와 **주문번호**는 각자의 테이블에서 기본키 였지만, **주문_상품** 테이블에서는 **관계를 찾아가기 위한 참조키 즉 외래 키 이다**. 

### 1. 식별관계(Identifying Relationship)

주문 테이블 속성에는 "회원 ID"가 있다. 이 또한 회원 테이블의 기본키 이며, 주문테이블이 외래키로 갖고 있는 것이다. 즉, 주문 테이블도 회원과의 관계를 이미 지니고 있다는 것이다. 

  주문_상품 테이블도 테이블이니 기본키가 필요하다. 어떤 키가 주문_상품 테이블의 고유한 데이터를 찾을 수 있는 기본키가 될 수 있을까?

주문_상품 테이블은 특정 주문이 구매한 상품의 수 만큼 로우가 쌓일것이다. 

**주문 번호 A주문**이 **상품 번호 1001, 1002 두개의 상품**을 구매하면 주문_상품 테이블에도 2개의 로우가 추가될 것이다. 그리고 **주문번호 B** **주문**이 B 상품 1개만 구매하면 1개의로우가 추가 될 것이다. 

**주문번호**도 중복될 수 있고, 상품번호도 중복될 수 있으니 단독으로 기본키가 될 수 없다.  2개를 합쳐서 본다면?? **주문번호**와 상품번호를 둘다 합친 "**하나의 주문**, 하나의 상품" 자체를 기본키로 본다면 주문이 중복될 수는 없으므로 고유하다고 볼 수 있다. 

기본키는 2개 이상의 컬럼으로 구성되는 것도 가능하고, 외래키가 기본키가 되는것도 가능하다. 

**외래키를 기본키로 사용하는 관계를 식별 관계라고 한다.**

![Untitled 3](https://user-images.githubusercontent.com/63430211/117440764-7723d600-af6f-11eb-9ba0-a8f57c4e7373.png)
### 2. 비식별 관계(Non Identifying Relationship)

식별관계는 하나의  주문에서 같은 상품을 2개 이상 사는 경우는 고려하지 않았다. 만약 주문번호 1001 주분에서 상품버호 1001, 1001, 1002 상품을 구매한다면 주문번호와 상품번호로 기본키를 구성할 수 없게 된다. 그렇기에 인조키를 이용하다.

**외래키들을 기본키로 사용하지 않고 일반 속성으로 취급하는 관계 ⇒ 비식별관계**

ERD에서 비식별 관계는 점선으로 표시한다.. 

![Untitled 4](https://user-images.githubusercontent.com/63430211/117440781-7ab75d00-af6f-11eb-8092-c55b977f9cf9.png)

### 1. 식별 관계

![Untitled 5](https://user-images.githubusercontent.com/63430211/117440795-7f7c1100-af6f-11eb-801c-aea1c716b4f2.png)

**식별관계** 

- 부모테이블 기본키 또는 유니크 키를 자식 테이블이 자신의 기본으로 사용하는 관계
- 부모테이블 키가 자신의 기본키에 포함되기 때문에 반드시 부모 테이블에 데이터가 존재해야 자식테이블에 입력가능

### 2. 비식별 관계

![Untitled 6](https://user-images.githubusercontent.com/63430211/117440815-84d95b80-af6f-11eb-8ea6-867655351447.png)

**비식별관계**

- 부모 테이블의 기본키 또는 유니크 키를 자신의 **기본키로 사용하지 않고** 외래키로 사용하는 관계
- 자식 데이터는 부모 데이터가 없어도 독립적으로 생성할 수 있다.
- 부모와 의존성을 줄일 수 있기 때문에 자유롭게 생성 및 수정 가능

### 3. 테이블 구성 시

식별관계

- 자식 테이터를 넣기 전, 부모 테이블에 필수적으로 데이터가 존재해야 한다.
- 기본키를 여러 복합 자연키로 처리하기 때문에 입력 데이터에 제한이 있다.

예시)

4륜 자동차 생성을 하려고 한다. 식별관계에서는 다음과 같이 넣을 수 있다. 

![Untitled 7](https://user-images.githubusercontent.com/63430211/117440831-8acf3c80-af6f-11eb-839b-20cd758e71bc.png)

자동차의 데이터

바퀴 데이터는 4개의 키가 묶여 복합 기본키를 가진다. 

![Untitled 8](https://user-images.githubusercontent.com/63430211/117440843-8dca2d00-af6f-11eb-8caa-6ca8019d320f.png)
바퀴의 데이터

위 테이블에서 왼쪽 앞ㅇ바퀴를 추가하고 싶으면? PK는 중복이 안되기에 불가능

즉 데이터의 정합성을 DB에서도 체크할 수 있게 된다. 

식별관계는 요구사항이 변하지 않을 때 강력한 데이터 정합성을 보장할 수 있다. 

반대로 요구사항이 변경되었을 떈 개발자의 발목을 잡는다. 

예를들어 왼쪽바퀴를 3개 이상으로 허용해야 한다고 ...?

그렇기에 테이블 설계 시 비식별 관계로 테이블 설계하는 것을 권장한다. 

비식별 관계로 테이블을 설계한다면  아래와 같다. 

![Untitled 9](https://user-images.githubusercontent.com/63430211/117440855-915db400-af6f-11eb-9104-39c00f648326.png)

비식별 관계 테이블

비식별관계에서 자동차를 만들기 전, 바퀴 데이터를 먼저 입력해야 한다고 요구사항이 변경되었을 때도 수용 가능하다. 

자신만 가진 인조키인 "바퀴_아이디" 를 가지고 있기 때문에 부모 테이블과 종속적인 관계 없이 독립적으로 존재할 수 있다.